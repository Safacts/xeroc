<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAVAN TEJA INTERNET</title>
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>PAVAN TEJA INTERNET</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                background-color: #fff;
                margin: 0;
                padding: 0;
                display: flex;
                flex-direction: column;
                min-height: 100vh;
            }
            header {
                background-color: #fff;
                padding: 20px;
                color: #333;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-radius: 20px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                margin: 20px auto;
                width: 90%; /* Centering header and fitting within the page */
            }
            header h1 {
                font-family: 'Pacifico', cursive;
                margin: 0;
                font-size: 24px;
                text-align: center;
                flex-grow: 1;
            }
            .search-bar {
                display: flex;
                align-items: center;
                margin-right: 20px;
            }
            .search-bar input {
                width: 300px;
                padding: 10px;
                font-size: 16px;
                border: 1px solid #ccc;
                border-radius: 20px;
                outline: none;
                background-color: #f0f0f0;
                margin-right: 10px;
            }

            .name-bar input {
                width: 277px;
                height: 19px;
                padding: 10px;
                font-size: 16px;
                border: 1px solid #ccc;
                border-radius: 20px;
                outline: none;
                background-color: #f0f0f0;
                margin-right: 0px;
            }
            
            .location-selector {
                margin-right: 20px;
            }
            .location-selector input {
                padding: 10px;
                font-size: 16px;
                border: 1px solid #ccc;
                border-radius: 20px;
                outline: none;
                background-color: #f0f0f0;
                width: auto;
            }
            .login-button {
                background: linear-gradient(135deg, #ff4d4d, #ff8080);
                border: none;
                padding: 10px 20px;
                font-size: 16px;
                cursor: pointer;
                border-radius: 20px;
                display: flex;
                align-items: center;
                color: white;
            }
            .login-button img {
                width: 20px;
                height: 20px;
                margin-right: 10px;
            }
            .content {
                flex: 1;
                padding: 20px;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            
            
            
            
            
            
            
            .card {
                background-color: #fff;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                margin: 20px auto; /* Changed this line */
                padding: 20px;
                width: 300px;
                text-align: center;
                display: block; /* Changed this line */
}
            .card img {
                width: 100%;
                border-radius: 10px 10px 0 0;
            }
            .card h2 {
                font-family: 'Georgia', serif;
                font-size: 24px;
                margin: 10px 0;
            }
            .card p {
                margin: 10px 0;
            }
            .card button {
                background: linear-gradient(135deg, #ff4d4d, #ff8080);
                border: none;
                padding: 10px 20px;
                font-size: 16px;
                cursor: pointer;
                border-radius: 20px;
                color: white;
            }
            footer {
                background-color: #333;
                color: white;
                padding: -100px;
                text-align: center;
                position: relative;
                width: 100%;
                
                margin-top: auto; /* Pushes the footer to the bottom */
                font-size: 12px; /* Reduced font size */
            }
            .modal {
                display: none;
                position: fixed;
                z-index: 1;
                padding-top: 100px;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0, 0, 0, 0.4);
            }
            .modal-content {
                background-color: #fff;
                margin: auto;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                width: 80%;
                max-width: 600px;
            }

            .modal-header, .modal-footer {
                padding: 10px;
                text-align: center;
            }
            .modal-header {
                font-size: 24px;
                font-weight: bold;
            }
            .modal-body {
                padding: 10px 0;
            }
            .modal-body input, .modal-body select {
                width: 100%;
                padding: 10px;
                margin: 10px 0;
                border-radius: 5px;
                border: 1px solid #ccc;
            }


            .modal-footer {
                padding: 10px;
                text-align: center;
            }
            
            
            .modal-footer button {
                padding: 10px 20px;
                margin: 10px;
                border: none;
                border-radius: 20px;
                cursor: pointer;
                background: linear-gradient(135deg, #ff4d4d, #ff8080);
                color: white;
            }

                        
            .modal-footer .close {
                background-color: #ff4d4d;
            }

            .modal-footer .save {
                background-color: #4caf50;
            }
    
            .start {
                display: flex;
                justify-content: center;
                margin-top: 20px;
            }
    
            #start-button button {
                padding: 10px 20px;
                border: none;
                border-radius: 25px;
                background-image: linear-gradient(135deg, #ff4d4d, #ff8080, #ff9a9e, #fbc2eb, #a6c1ee); /* Brighter gradient */
                color: white;
                font-size: 16px;
                cursor: pointer;
                background-size: 200% 200%;
                animation: gradientAnimation 3s ease infinite;
            }
    
            @keyframes gradientAnimation {
                0% {
                    background-position: 0% 50%;
                }
                50% {
                    background-position: 100% 50%;
                }
                100% {
                    background-position: 0% 50%;
                }
            }

            /* Assuming your image has a class or ID (e.g., .login-image or #login-image) */
            .login-image img {
                max-width: 50px;
                height: 50px;
                display: block; /* Ensures proper alignment */
                margin-right: 6px; /* Adjust as needed */
            }
            .profile-image {
                width: 50px;
                height: 50px;
                border-radius: 50%;
                cursor: pointer;
                overflow: hidden; /* Ensure the image or letter stays within the circle */
                position: relative; /* Ensure proper layering for animation */
            }
    
            .profile-image img {
                width: 100%;
                height: 100%;
                object-fit: cover; /* Ensure the image fills the circle */
            }
    
            .profile-image .profile-initial {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 24px;
                color: white;
                background: linear-gradient(135deg, #ff4d4d, #ff8080);
                animation: gradientAnimation 3s ease infinite;
            }
    
            /* Adjust animation keyframes for smooth gradient animation */
            @keyframes gradientAnimation {
                0% {
                    background-position: 0% 50%;
                }
                50% {
                    background-position: 100% 50%;
                }
                100% {
                    background-position: 0% 50%;
                }
            }

            .profile-image {
                width: 50px;
                height: 50px;
                border-radius: 50%;
                cursor: pointer;
                overflow: hidden; /* Ensure the image or letter stays within the circle */
                position: relative; /* Ensure proper layering for animation */
            }
    
            .profile-image img {
                width: 100%;
                height: 100%;
                object-fit: cover; /* Ensure the image fills the circle */
            }
    
            .profile-image .profile-initial {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 24px;
                color: white;
                background: linear-gradient(135deg, #ff4d4d, #ff8080);
                animation: gradientAnimation 3s ease infinite;
            }
    
            /* Adjust animation keyframes for smooth gradient animation. */
            @keyframes gradientAnimation {
                0% {
                    background-position: 0% 50%;
                }
                50% {
                    background-position: 100% 50%;
                }
                100% {
                    background-position: 0% 50%;
                }
            }

            .footer-link {
                color: white;
                text-decoration: none; /* Removes underline */
                transition: color 0.3s ease; /* Smooth transition effect */
            }
            
            .footer-link:hover {
                color: #fbc2eb; /* Change to your preferred highlight color */
            }

            







            
           
            #fileMetadata {
                font-family: monospace;
                margin-top: 10px;
                white-space: pre-wrap; /* Ensures the text wraps within the card */
                word-wrap: break-word; /* Ensures long words break to fit within the card */
                text-align: left; /* Aligns the text to the left */
            }


            #progressBar {
                width: 100%;
                background-color: #f3f3f3;
                border-radius: 20px;
                overflow: hidden;
                margin-top: 10px;
                position: relative;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            }
            
            #progressBar div {
                height: 20px;
                width: 0;
                background: linear-gradient(135deg, #ff4d4d, #ff8080, #ff9a9e, #fbc2eb, #a6c1ee);
                text-align: center;
                line-height: 20px;
                color: white;
                border-radius: 20px 0 0 20px;
                transition: width 0.4s ease, background-position 0.4s ease;
                background-size: 200% 200%;
                animation: gradientAnimation 3s ease infinite;
            }
            
            @keyframes gradientAnimation {
                0% {
                    background-position: 0% 50%;
                }
                50% {
                    background-position: 100% 50%;
                }
                100% {
                    background-position: 0% 50%;
                }
            }
            
            #progressBar div::after {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                bottom: 0;
                width: 4px;
                background-color: white;
                box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
                opacity: 0;
                animation: shine 2s infinite linear;
            }
            
            @keyframes shine {
                0% {
                    opacity: 0;
                    transform: translateX(-100%);
                }
                50% {
                    opacity: 1;
                }
                100% {
                    opacity: 0;
                    transform: translateX(100%);
                }
            }

            .file-upload {
                width: 300px;
                display: flex;
                flex-direction: column;
                align-items: center;
                position: relative;
                z-index: 2;
            }
            
            .file-upload input[type="file"] {
                width: 85%;
                padding: 20px;
                font-size: 16px;
                border: 2px dashed #ccc;
                border-radius: 20px;
                outline: none;
                background-color: #f9f9f9;
                text-align: center;
                cursor: pointer;
                transition: border-color 0.3s ease, background-color 0.3s ease;
            }
            
            .file-upload input[type="file"]:hover {
                border-color: #ff4d4d; /* Match gradient colors */
                background-color: #ffe6e6; /* Lighten background on hover */
            }
            
            .file-upload input[type="file"]::-webkit-file-upload-button {
                display: none; /* Hide the default file input button */
            }
            
            .file-upload::before {
                content: 'Drag or Select a File';
                display: block;
                font-size: 16px;
                color: #333;
                margin-bottom: 10px;
                transition: color 0.3s ease;
            }
            
            .file-upload input[type="file"]::file-selector-button {
                background-image: linear-gradient(135deg, #ff4d4d, #ff8080, #ff9a9e, #fbc2eb, #a6c1ee);
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 25px;
                cursor: pointer;
                font-size: 16px;
                transition: background-color 0.3s ease, transform 0.3s ease;
            }
            
            .file-upload input[type="file"]::file-selector-button:hover {
                background-color: #ff9a9e;
                transform: scale(1.05);
            }

            .custom-popup {
                display: none;
                position: fixed;
                z-index: 1000; /* Ensure this is higher than other elements */
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0, 0, 0, 0.4);
            }
            
            .custom-popup-content {
                background-color: #fff;
                margin: 15% auto;
                padding: 20px;
                border: 1px solid #888;
                width: 80%;
                max-width: 400px;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                text-align: center;
            }
            
            .close-btn {
                color: #aaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
            }
            
            .close-btn:hover,
            .close-btn:focus {
                color: black;
                text-decoration: none;
                cursor: pointer;
            }
            
            
            
            @media (max-width: 768px) {
                .search-bar {
                    display: none;
                }
            
                .location-selector {
                    display: none;
                }
            
                header {
                    flex-direction: column;
                    align-items: flex-start;
                }
            
             
                   
                
                
                
                
                
            }













            
        /* Add pure white background spacer */
        .spacer {
            background-color: #b2beb5;
            height: 300px;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0px 10px 15px rgba(0, 0, 0, 0.6);
        }

        
        .footer {
            background: #000;
            color: #fff;
            padding: 20px;
            text-align: center;
            margin-top: auto;
            font-size: 0.9rem;
        }

        .spacer {
            background-color: #fff;
            height: 125px;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            display: flex;
            justify-content: center; /* Center content horizontally */
            align-items: center; /* Center content vertically */
        }
        
        .soc-med {
            display: flex;
            justify-content: center; /* Align images at the center horizontally */
            align-items: center; /* Align images at the center vertically */
        }
        
       
        .wat-img {
            width: auto; /* Set the width to auto to maintain aspect ratio */
            height: 85px; /* Set the height of all images */
            margin: 0 0px; /* Add margin between images */
            
            
            object-fit: contain; /* Ensure the entire image is visible within the specified dimensions */
        }
        
        

        /* Media Query for mobile devices */
        @media only screen and (max-width: 768px) {
            .product-card {
                width: calc(100% - 20px);
            }

            /* Add pure white background spacer */
            .spacer {
                background-color: #b2beb5;
                height: 100px;
                border-top-left-radius: 20px;
                border-top-right-radius: 20px;
            }

            /* newly added <<<<<<<<<<<<<<< */

          

            .spacer {
                background-color: #fff;
                height: 95px; /* Adjust the height to accommodate the .msg div */
                border-top-left-radius: 20px;
                border-top-right-radius: 20px;
                display: grid;
                justify-content: center;
                align-items: center;
                position: relative;
                box-shadow: 0px 10px 15px rgba(0, 0, 0, 0.7);
            }
    
            .msg {
                display: flex;
                justify-content: center;
                align-items: center;
                position: absolute;
               
                left: -6%;
                width: 100%;
                height: 100%;
                font-size: 10px; /* Set the font size to 14px */
            }


            .soc-med {
                display: flex;
                justify-content: center; /* Align images at the center horizontally */
                align-items: center; /* Align images at the center vertically */
                margin-left: 140px;
            }
            
           
            .wat-img {
                width: auto; /* Set the width to auto to maintain aspect ratio */
                height: 45px; /* Set the height of all images */
                position: relative;
                margin: 0 0px; /* Add margin between images */
                object-fit: contain; /* Ensure the entire image is visible within the specified dimensions */
            }
            
           





        }



            
            
        </style>
</head>

<body>
<header>
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search for our services...">
        <div class="location-selector">
            <input list="cities" id="locationInput" placeholder="Select Location" onchange="filterCaterersByCity(this.value)">
            <datalist id="cities"></datalist>
        </div>

   </div>
   <h1>PAVAN TEJA INTERNET</h1>
</header>

<div id="custom-popup" class="custom-popup">
    <div class="custom-popup-content">
        <span class="close-btn" onclick="closeCustomPopup()">&times;</span>
        <p id="popup-message"></p>
    </div>
</div>

<div class="start" id="start-button">
    <button onclick="location.href='{% url 'password' %}'">Get started</button>
</div>



<div class="card">
    <div class="card-body">
        <h5 class="card-title">Upload Your File</h5>

        <!-- File Selection Bar -->
        <form id="uploadForm" method="post" enctype="multipart/form-data">
            {% csrf_token %}

             <!-- User Name Input -->
             <div class="name-bar">
                <input type="text" id="userNameInput" class="form-control" placeholder="Enter your name" required>
            </div>

            

            <br>
            <div class="file-upload">
                <input type="file" id="fileInput" class="form-control" style="border: 2px dashed #ccc; padding: 20px; text-align: center;" oninput="displayFileMetadata()">
            </div>
            
            <br>

            <!-- Display File Metadata -->
            <pre id="fileMetadata" style="font-family: monospace; margin-top: 10px;"></pre>

            <!-- Progress Bar -->
            <div id="progressBar"><div></div></div>
            <br>

            <!-- Upload Button -->
            <button id="uploadButton" class="btn btn-primary mt-3" type="button" onclick="uploadFile()">Upload</button>
        </form>
    </div>
</div>



<!-- 
<div class="content" id="cardsContainer">
    <div class="card" data-city="Wanparthy">
        <img src="https://tazlabaotelsvdmtfpui.supabase.co/storage/v1/object/public/caterer%20images/suraj%20caterers.png" alt="Catering Service 1">
        <h2>SURAJ CATERERS</h2>
        <p>Contact: 96789299XX</p>
        <p>Email: surajcaterers01@gmail.com</p>
        <p>City: Wanparthy</p>
        <p>Price per Plate: ₹105<span id="price1">{{ price1 }}</span></p>
        <button onclick="showOrderModal('SURAJ CATERERS')">Place Order</button>
    </div>
    <!- Add more cards as needed 
   </div>
-->

<br>

<br>

<br>

<br>

<br>

<div class="spacer">
    <div class="msg">
        <h2>Send your files on!!</h3>
    </div>
    <div class="soc-med">
        <a href="https://wa.me/+919491804064" target="_blank">
            <img class="wat-img" src="https://ehtjgdywsyvlshqpxbum.supabase.co/storage/v1/object/public/images/watsapp_logo-removebg-preview.png?t=2024-03-26T03%3A10%3A02.449Z" alt="WhatsApp">
        </a>
        
    </div>
</div>

<footer class="footer">
    &copy; 2024 YR Corporation. All rights reserved.
    <p>
    {% if view_count %}
        Page Views: {{ view_count }}
    {% else %}
        Welcome! Be the first to view this page.
    {% endif %}
</footer>


<script>
    const apiKey = 'ba9de512128c422abe90467115b6573a';

    

    // Define the file size limit (in bytes)
    const MAX_FILE_SIZE_MB = 4.6;
    const MAX_FILE_SIZE_BYTES = MAX_FILE_SIZE_MB * 1024 * 1024;

    // Helper function to get CSRF token
    function getCookie(name) {  //increased temporarily
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    document.getElementById('searchInput').addEventListener('input', function() {
        let filter = this.value.toLowerCase();
        let cards = document.getElementsByClassName('card');
        for (let i = 0; i < cards.length; i++) {
            let card = cards[i];
            let cardTitle = card.getElementsByTagName('h2')[0].innerText.toLowerCase();
            if (cardTitle.includes(filter)) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        }
    });

    document.getElementById('plates').addEventListener('input', calculateTotalCost);

    function showOrderModal(serviceName) {
        document.getElementById('orderModalHeader').innerText = `Place Order - ${serviceName}`;
        document.getElementById('orderModal').style.display = 'block';
    }
    

    

    function filterCaterersByCity(city) {
        let cards = document.getElementsByClassName('card');
        for (let i = 0; i < cards.length; i++) {
            let card = cards[i];
            let cardCity = card.getAttribute('data-city');
            if (cardCity.toLowerCase() === city.toLowerCase()) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        }
    }

    async function detectLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(async position => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                const city = await getCityFromCoordinates(lat, lng);
                document.getElementById('locationInput').value = city;
                filterCaterersByCity(city);
            }, error => {
                showCustomPopup('Error getting location: ' + error.message);
            });
        } else {
            showCustomPopup('Geolocation is not supported by this browser.');
        }
    }
        
    async function getCityFromCoordinates(lat, lng) {
        const response = await fetch(`https://api.opencagedata.com/geocode/v1/json?q=${lat}+${lng}&key=${apiKey}`);
        const data = await response.json();
        return data.results[0].components.city;
    }

    async function populateCityOptions() {
        const response = await fetch('https://countriesnow.space/api/v0.1/countries/cities', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ country: 'India' }),
        });

        const data = await response.json();
        const cities = data.data;
        const cityList = document.getElementById('cities');

        cities.forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city; // Added this line to set the text content of the option
            cityList.appendChild(option);
        });
    }

    // Call detectLocation and populateCityOptions on page load
    window.onload = async () => {
        await populateCityOptions();
        await detectLocation();
    };

    function displayFileMetadata() {
        const fileInput = document.getElementById('fileInput');
        const fileMetadata = document.getElementById('fileMetadata');

        // Clear previous metadata
        fileMetadata.textContent = '';

        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            const uploadDate = new Date().toLocaleDateString();
            const metadata = `File Name: ${file.name}\nFile Size: ${(file.size / 1024).toFixed(2)} KB\nFile Type: ${file.type}\nUpload Date: ${uploadDate}`;

            fileMetadata.textContent = metadata;
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const uploadButton = document.getElementById('uploadButton');
        const fileInput = document.getElementById('fileInput');
        const fileMetadata = document.getElementById('fileMetadata');

        // Display file metadata when a file is selected
        fileInput.addEventListener('change', function() {
            const file = fileInput.files[0];
            if (file) {
                fileMetadata.textContent = `File Name: ${file.name}, Size: ${file.size} bytes, Type: ${file.type}`;
            } else {
                fileMetadata.textContent = '';
            }
        });

        // Upload file when the upload button is clicked
        uploadButton.addEventListener('click', uploadFile);
    });



    function showCustomPopup(message, whatsappLink = null) {
        return new Promise((resolve) => {
            const popupMessageElement = document.getElementById('popup-message');
            popupMessageElement.innerHTML = message; // Use innerHTML to render HTML content
            document.getElementById('custom-popup').style.display = 'block';
            document.body.classList.add('blur-background');
    
            if (whatsappLink) {
                const whatsappLinkElement = document.getElementById('whatsapp-link');
                whatsappLinkElement.href = whatsappLink;
                whatsappLinkElement.style.display = 'block';
            } else {
                document.getElementById('whatsapp-link').style.display = 'none';
            }
    
            // Resolve the promise after the popup is shown
            resolve();
        });
    }

    

    async function uploadFile() {
        const userNameInput = document.getElementById('userNameInput');
        const fileInput = document.getElementById('fileInput');
        const fileMetadata = document.getElementById('fileMetadata');
        const progressBar = document.getElementById('progressBar').firstElementChild;
    
        let userName = userNameInput.value.trim();  // Trim leading/trailing spaces
        if (userName === '') {
            showCustomPopup('Please enter your name before uploading.');
            return;
        }

        userName = userName.replace(/\s+/g, '_');  // Replace spaces with underscores
    
        if (fileInput.files.length === 0) {
            showCustomPopup('Please select a file before uploading.');
            return;
        }
    
        
        const file = fileInput.files[0];
        // Check file size
        if (file.size > MAX_FILE_SIZE_BYTES) {
            // Display popup with WhatsApp link
            const message = `File ${file.name} exceeds the 4.6 MB limit. Please send it on WhatsApp.`;
            const phoneNumber = '+919491804064'; // Replace with your WhatsApp number
            const whatsappURL = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            await showCustomPopup(`File exceeded limit. Try sending on <a href="${whatsappURL}" target="_blank">WhatsApp</a>`);
            return;
        }


        const formData = new FormData();
        formData.append('file', file);
        formData.append('user_name', encodeURIComponent(userName));  // Encode username
    
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/upload/', true);
        xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));
    
        xhr.upload.onprogress = function(event) {
            if (event.lengthComputable) {
                const percentComplete = (event.loaded / event.total) * 100;
                console.log(`Progress: ${percentComplete}%`); // Debugging statement
                progressBar.style.width = percentComplete + '%';
                progressBar.textContent = Math.round(percentComplete) + '%';
            }
        };
    
        xhr.onloadstart = function() {
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
        };
    
        xhr.onload = async function() {
            const response = JSON.parse(xhr.responseText);
            const fileUrl = response.file_url;  // Get the file_url from the response
            console.log('File URL:', fileUrl);  // Debug print
    
            // Redirect to confirm_upload with the file_url
            const confirmResponse = await fetch(`/confirm_upload/?file_url=${encodeURIComponent(fileUrl)}`);
            const confirmData = await confirmResponse.json();
    
            if (confirmData.success) {
                progressBar.style.width = '100%';
                progressBar.textContent = 'Upload Complete!';
                showCustomPopup('File uploaded successfully:\n' + fileMetadata.textContent);
            } else {
                progressBar.style.width = '100%';
                progressBar.textContent = 'Upload Failed!';
                showCustomPopup('File upload failed: ' + (confirmData.error || 'Unknown error'));
            }
    
            setTimeout(function() {
                var resetCounter = 3;
                var resetInterval = setInterval(function() {
                    
                    if (resetCounter > 0) {
                        progressBar.textContent = "Resetting in " + resetCounter + "...";
                        resetCounter--;
                    } else {
                        clearInterval(resetInterval);
                        progressBar.style.width = '0%';
                        fileInput.value = ""; 
                        fileMetadata.textContent = ''; 
                        progressBar.textContent = "";
                        var fileLabel = document.querySelector('.file-upload input[type="file"]');
                        fileLabel.previousElementSibling.textContent = "Choose another file";
                        document.querySelector('.file-upload label').textContent = "Choose another file";
                    }
                }, 1000);
            }, 3000);
        };
    
        xhr.onerror = function() {
            console.error('An error occurred during the transaction');
            progressBar.style.width = '100%';
            progressBar.textContent = 'Upload Failed!';
            showCustomPopup('File upload failed.');
        };
    
        xhr.send(formData);
    }
    

    
    

    

    
    
    function closeCustomPopup() {
        document.getElementById('custom-popup').style.display = 'none';
    }
    

    function redirectToWhatsApp(phoneNumber, productId) {
        // Define the product card element
        // Construct the WhatsApp URL with pre-filled message
        var whatsappURL = 'https://wa.me/' + phoneNumber + '?text=' + encodedMessage;
            
        // Open the WhatsApp URL in a new tab
        window.open(whatsappURL, '_blank');
    }

</script>
</body>
</html>